# Agent使用说明

## 1. 引言

本手册旨在详细介绍 13 智能体先遣队（Agent Team）的协同工作流程。它将指导您如何以测试驱动开发（TDD）为核心，安全左移为原则，像素级还原为目标，来独立开发一个完整的核心功能模块。

### 核心理念：TDD Is Law

我们的工作流不是“先开发，后测试”，而是 **“先测试，后开发”**。

我们将指挥单元测试工程师 (Agent 5) 和 UI 自动化测试工程师 (Agent 11) 首先编写失败的测试代码（RED），然后指挥后端开发工程师 (Agent 6) 和前端开发工程师 (Agent 8, 9) 编写刚好能让测试通过的代码（GREEN），最后由重构专家 (Agent 7) 进行优化（REFACTOR）。

## 2. 智能体花名册

| 职能组 | 编号 | 智能体名称 | 核心职责 |
| :--- | :--- | :--- | :--- |
| **指挥部** | 1 | 首席项目经理 (Chief PM) | 拆解需求，定义验收标准 (AC) |
| **指挥部** | 2 | 系统架构师 (Architect) | 定义 API 契约与数据库 Schema |
| **统筹组** | 3 | 应用流程编排 (Builder) | **搭建代码骨架 (TDD 的靶子)** |
| **后勤组** | 4 | **数据生成工程师 (Data)** | **解决“无数据可测”的死锁** |
| **后端 TDD** | 5 | **单元测试工程师 (RED)** | **编写失败的后端测试** |
| **后端 TDD** | 6 | **后端开发 (GREEN)** | **让后端测试通过** |
| **后端 TDD** | 7 | **代码重构 (REFACTOR)** | 优化后端代码 |
| **前端 TDD** | 8 | 像素级 UI 开发 (Pixel UI) | 实现 1:1 静态 UI (VDD) |
| **前端 TDD** | 9 | 前端路由与逻辑 (Router) | 接入 API，处理状态 (BDD) |
| **前端 TDD** | 10 | 交互体验专家 (UX) | 优化 Loading、交互反馈 |
| **前端 QA** | 11 | **UI 自动化测试 (RED)** | **编写失败的组件功能测试** |
| **前端 QA** | 12 | **视觉回归测试 (VRT)** | **编写像素比对测试** |
| **安全组** | 13 | 蓝队安全架构师 (Blue) | 注入安全基因，代码加固 |



## 3. 使用说明：TDD 单模块开发 - 6 步操作指南

要开发一个新功能（例如“首页/查询页”），请严格按照以下 6 个步骤顺序下达指令。

### 第 1 步：定规矩与搭骨架 (Definition \u0026 Scaffolding)

此阶段为 TDD 搭建“靶场”。Builder (Agent 3) 生成的空方法是 Unit Test (Agent 5) 编写红测试的目标。

- **激活智能体**:
  1. 首席项目经理 (Chief PM)
  2. 系统架构师 (Architect)
  3. 应用流程编排 (Builder)
- **流程**:
  1. PM 解析你的需求文档，输出验收标准 (AC)。
  2. Architect 根据 AC 定义数据库 Schema 和 API 契约。
  3. Builder 根据 API 契约生成空的前后端代码骨架（Controller, Service 都是空方法）。
- **标准指令**:
  ```
  “请启动第一步。请 PM 解析我上传的需求文档，架构师 定义接口和数据库，然后让 Builder 生成前后端的代码骨架。”
  ```

### 第 2 步：造数据 (Data Seeding)

此阶段解决 TDD 流程中的“无米之炊”问题。没有数据，查询测试永远返回空。

- **激活智能体**:
  - 4. 数据生成工程师 (Data Engineer)
- **流程**:
  - Data Engineer 根据 Architect 的 Schema，编写脚本向 SQLite 数据库中填充海量、逼真的测试数据（车次、车站、用户等）。
- **标准指令**:
  ```
  “请启动第二步。请 数据生成工程师 根据架构师的设计，编写脚本并生成【模块名，如：车票查询】所需的测试数据。”
  ```

### 第 3 步：后端 TDD 循环 (Backend RED-GREEN-REFACTOR)

这是严格的后端 TDD 流程。

- **激活智能体**:
  1. 5. 单元测试工程师 (Unit Test - RED)
  2. 6. 后端开发 (Backend Dev - GREEN)
  3. 7. 代码重构 (Refactor)
- **流程**:
  1. **[RED]**: Unit Test 针对 Builder 的空方法，编写必然失败的测试用例（例如：测试查询逻辑，断言应返回数据，但目前返回空）。
  2. **[GREEN]**: Backend Dev 编写最小化的业务逻辑，让所有 RED 测试通过（GREEN）。
  3. **[REFACTOR]**: Refactor 介入，在测试持续通过的前提下，优化代码性能和结构。
- **标准指令**:
  ```
  “请启动第三步。请 单元测试智能体 编写后端测试用例，然后让 后端开发智能体 实现逻辑直到测试通过，最后让 重构专家 优化代码。”
  ```

### 第 4 步：前端 TDD 循环 (Frontend BDD/VDD)

这是前端的 TDD/VDD（视觉驱动开发）流程。

- **激活智能体**:
  1. 8. 像素级 UI 开发 (Pixel UI)
  2. 9. 前端路由与逻辑 (Router)
  3. 10. 交互体验专家 (UX)
- **流程**:
  1. **[RED]**: （此步骤由 Agent 11/12 在下一步执行，但开发时需以此为目标）
  2. **[GREEN]**: Pixel UI 负责实现 1:1 静态 UI。Router 负责接入第 3 步产出的 API，实现状态管理和交互逻辑。UX 负责添加 Loading 等反馈。
- **标准指令**:
  ```
  “请启动第四步。请 UI 开发智能体 还原 PDF 截图的静态页面，然后让 路由智能体 对接后端接口，最后由 UX 专家 优化交互体验。”
  ```

### 第 5 步：前端质量验收 (Frontend QA \u0026 TDD Validation)

此阶段验证前端代码是否符合功能预期和视觉预期，是 TDD 流程的闭环。

- **激活智能体**:
  1. 11. UI 自动化测试 (UI Auto Test)
  2. 12. 视觉回归测试 (Visual Regression)
- **流程**:
  1. **[Functional TDD]**: UI Auto Test 编写 Vitest/RTL 脚本，测试组件功能（例如：点击按钮是否触发了 Mock 的 API 调用）。
  2. **[Visual TDD]**: Visual Regression 编写 Playwright/Cypress 脚本，进行像素级快照对比，确保 UI 还原度 100%。
- **标准指令**:
  ```
  “请启动第五步。请 UI 自动化测试 验证组件功能，然后让 视觉回归测试 进行像素级比对，确保 UI 还原度。”
  ```

### 第 6 步：安全加固 (Security Shift-Left)

此阶段将安全测试融入 TDD，确保模块在开发完成时即具备防御能力。

- **激活智能体**:
  - 13. 蓝队安全架构师 (Blue Team Architect)
- **流程**:
  - Blue Team 对第 3 步产出的后端代码进行审计和加固。例如：检查“车票查询”接口是否严格使用了参数化查询，防止 SQL 注入。
- **标准指令**:
  ```
  “请启动第六步。请 蓝队架构师 对当前模块进行代码审计和安全加固，确保无 SQL 注入和 XSS 风险。”
  ```

